// Generated by CoffeeScript 1.12.4
var FacebookMoLo;

FacebookMoLo = (function() {
  FacebookMoLo.prototype.fbCallbackParam = 'fbauthcallback=1';

  function FacebookMoLo(facebook, appId, scope, rerequest) {
    this.facebook = facebook;
    this.appId = appId;
    this.scope = scope;
    this.rerequest = rerequest != null ? rerequest : false;
  }

  FacebookMoLo.prototype.isSuccessfulCallback = function(uri) {
    if (uri == null) {
      uri = null;
    }
    if (uri === null) {
      uri = window.location.href;
    }
    return new RegExp(this.fbCallbackParam).test(window.location.href) && /error=/.test(uri) === false;
  };

  FacebookMoLo.prototype.authenticate = function(callback, redirectUri) {
    if (redirectUri == null) {
      redirectUri = null;
    }
    if (redirectUri === null) {
      redirectUri = window.location.href;
    }
    return this.facebook.getLoginStatus((function(_this) {
      return function(authResponse) {
        if (authResponse && authResponse.status === 'connected') {
          return callback(authResponse);
        }
        return _this.login(redirectUri);
      };
    })(this));
  };

  FacebookMoLo.prototype.login = function(redirectUri) {
    var href, queryParams, redirect;
    redirect = document.createElement('a');
    redirect.href = redirectUri;
    queryParams = [];
    if (/\?/.test(redirect.search) === true) {
      queryParams = redirect.search.replace('?', '').split('&');
    }
    queryParams.push(this.fbCallbackParam);
    redirect.search = '?' + queryParams.join('&');
    href = "https://m.facebook.com/dialog/oauth?" + "client_id=" + this.appId + "&scope=" + this.scope + "&redirect_uri=" + encodeURIComponent(redirect.href);
    if (this.rerequest === true) {
      href = href + "&auth_type=rerequest";
    }
    return window.location.href = href;
  };

  return FacebookMoLo;

})();
